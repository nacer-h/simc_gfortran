      SUBROUTINE H2MODEL_LIANG(QQ,WW,W1,W2)
                       
c      INCLUDE 'model_liang.cmn'
      
      INTEGER I,J,j1,i1,tmp
      REAL*8 QQ,WW,W1,W2,WW1,WW2,W11,W22
      REAL*8 R,F2,NU,MP,MP2,R1,F21,R2,F22
      REAL*8 Q4,Q6,frac,xx,fac,rlog,Q8 
      REAL*8 RP(276), F2P(552),tmp1,tmp2
      REAL*8 Q,QTH,DQ,Y,F2TH,LIN,BINDING
      REAL*8 SCB,QUAD

      LOGICAL TEST
      COMMON/MODEL_LIANG/RP,F2P
      COMMON/MODEL_LIANG1/TEST
 
      MP = .9382727
      MP2 = MP*MP
    
c      write(*,*) QQ,WW
      IF (WW.LT.1.15) THEN
         W1 = 0.
         W2 = 0.        
      ELSE IF (WW.GT.3.9) THEN
         CALL H2MODEL(QQ,WW,W1,W2)
      ELSE
c       write(*,*) test
        if (.not.test) then 
c        write(*,*) 'Reading parameters for Liang model'
        test = .true.

      DATA RP/
     >   0.48530,  -0.11465,   2.15598,  -0.68159,    3.9252,  23.44669,
     >   0.50596,  -0.08107,   1.01007,   3.70327,   17.2949,  28.38332,
     >   0.55419,  -0.15364,   1.61386, -12.42321,   35.4126,  30.81327,
     >   0.85559,   0.11350,   0.05408,  -9.40508,    0.9175,   8.40163,
     >  -0.55221,   3.93366,  -0.60720,  -2.42692,    2.1872,   1.35390,
     >   0.88101,   0.79196,   0.36389,  68.46841,  -98.6147,  63.49664,
     >   0.41264,  -0.09145,   1.04713,  31.60005,   64.7931,  21.89128,
     >   0.36597,  -0.41582,   4.98377,  -4.95666,   28.5972,  23.58650,
     >   0.43391,  -0.06414,   1.09306, -16.41644,   21.5183,  11.60108,
     >   0.36205,   0.11829,   0.01930,  -1.11240,    5.0765,   3.82646,
     >   0.27171,   0.31385,   0.03697,  -1.52603,    2.8538,   2.67233,
     >   0.27773,   0.14491,   0.00710,  -2.62023,    6.3815,   1.82783,
     >   0.19186,   0.20058,   0.03654,  -1.17056,    4.6770,   2.01678,
     >   0.10130,   0.30934,   0.12452,  -0.72705,    3.1584,   2.28117,
     >   0.03521,   0.38544,   0.02406,  -0.99386,    3.4299,   1.65473,
     >  -0.13064,   0.40820,  -0.09059,  -2.33567,    5.7631,   0.64259,
     >  -0.07724,   0.21792,  -0.04704,  -4.26269,   10.8271,   0.13991,
     >  -0.44769,   1.22905,  -0.21719,  -2.49814,    3.7869,   0.76381,
     >  -0.50555,   0.64562,   0.12413,  -3.27155,    6.8195,   0.64093,
     >   0.28395,   0.88471,   0.11747,  59.92427,  -67.7875,   7.03951,
     >   0.29917,  -0.12868,   1.43008,   6.43871,   29.6337,   5.91148,
     >   0.23577,  -0.03344,   0.48974,  14.42496,   38.2481,   5.07415,
     >   0.19255,   0.03212,   0.13922,  53.09655,  -34.0586,   4.10071,
     >   0.12178,   0.03175,   0.06956,  20.05138,    6.5926,   2.93039,
     >   0.15298,   0.06052,   0.04580,   5.20552,    5.7356,   1.96076,
     >   0.11642,   0.38652,   0.25491,  -1.91854,    3.2891,   1.78546,
     >   0.11570,   0.05604,   0.03422,   3.05344,   10.9044,   1.21077,
     >   0.08419,   0.08959,   0.08464,   1.71526,    6.7603,   1.24895,
     >  -0.02973,   0.31026,   0.23164,  -1.84482,    5.2556,   1.11996,
     >  -0.20431,   0.21299,   0.05380,  -0.64322,    8.2768,   0.51110,
     >   0.18543,   0.32496,   0.07501,  40.28852,  -46.0516,   3.63145,
     >   0.15311,   0.19478,   0.05368,  65.56111,  -73.9357,   3.07603,
     >   0.14226,   0.31868,   0.08152,  62.51236,  -72.5987,   3.38117,
     >   0.14709,   0.39196,   0.12420,  49.79169,  -58.3382,   3.49087,
     >   0.12612,   0.30932,   0.16086,  39.17756,  -44.7770,   3.18018,
     >   0.12857,   0.08735,  -0.00484,  62.03786,  -63.5659,   2.29814,
     >   0.07630,   0.03737,   0.04755,  15.07979,    8.6227,   1.43641,
     >   0.08330,   0.11046,   0.14218,   2.51425,    5.2852,   1.58785,
     >   0.13692,   0.09586,   0.03803,  69.90237,  -76.3172,   2.47748,
     >  -0.37316,   0.04429,  -0.00268,  16.97609,   30.8935,  -0.16524,
     >  -0.58333,   0.12357,   0.00777,   8.14621,   13.7920,   0.01285,
     >   0.10647,   0.18664,   0.14751,  40.49379,  -46.3918,   2.38107,
     >  -0.45124,   0.10119,   0.03017,   9.06721,   14.6193,   0.13045,
     >  -0.17977,   0.09335,  -0.00354,  15.78055,   -0.5898,   0.25654,
     >  -0.13536,   0.10046,  -0.00576,  17.60386,   -5.7614,   0.34554,
     >  -0.09634,   0.05233,  -0.00979,  32.55109,  -11.9164,   0.22282/
      
      DATA F2P/
     >   0.00011,   0.02724,   0.21362,   0.05027,  -0.65781,  -2.59371,
     > -41.92304,  39.56703,  -33.1637, -18.49852, -39.41722,  88.14147,
     >  -0.05687,   2.39067,  -5.69215,  -7.76595,  21.65026,  -3.63545,
     > -39.00144,  40.36704,  -13.1738,-113.02800, 128.93600,  -1.17633,
     >  -0.00896,   0.33044,   0.74546,  -1.34826,   0.05872, -30.86312,
     > -62.71798,  82.62181, -124.9519,  -6.70174, -10.83118, 141.17580,
     >   0.01396,  -0.19008,   1.85959,   0.71959,  -1.41138,  26.41986,
     >  87.13830, -99.59572,  111.1218,  55.02445,   0.79086,-167.76700,
     >  -0.02884,   1.29782,   1.19657,  -0.74100,   0.81981,   7.42490,
     > -57.69122,  48.95333,   17.7917,-146.81900, 130.62680,   1.27944,
     >   0.03551,   1.13985,  -0.64863,  -0.43321,   3.55059,   4.04357,
     > -22.36563,  19.05210,   10.9252, -59.74677,  54.16417,  -2.54505,
     >   0.08361,   0.91999,  -2.45490,   9.68010,  -7.37009,  -1.17213,
     >   8.95919,  -5.99223,   -2.7622,  24.67691, -23.09255,   3.23059,
     >   0.20692,  -0.25832,   3.27708,   4.66277,  -6.36445,   1.06069,
     >   0.61306,   0.16086,    3.9566,  -3.95941,   8.62243,  -6.35474,
     >   0.12563,  -0.00541,   1.85384,   2.74658,  -2.52016,   1.55157,
     >  -1.53893,   2.05576,    5.3230, -10.81944,  16.38832,  -8.47217,
     >   0.24590,  -1.02576,   3.47060,   5.78075,  -5.90841,  -0.41281,
     > -13.94658,  15.35958,   -2.9324, -20.88938,  22.49241,   4.72775,
     >   0.17848,  -0.56694,   1.70780,   3.31081,  -1.33899,  -1.67445,
     > -22.96826,  24.88553,   -8.3161, -26.53902,  22.70171,  16.36064,
     >   0.14115,  -0.33032,   1.19282,   2.01225,  -0.88951,  -1.09392,
     > -13.44853,  15.56672,   -5.1082, -13.21899,  11.11273,  10.91725,
     >   0.08363,  -0.28349,   0.39298,   1.57190,   1.18218, -23.52104,
     >-201.44600, 209.28080, -101.7928,-160.59850,  75.22465, 206.56360,
     >   0.08487,  -0.25646,   0.46501,   1.31723,   0.65586, -19.89832,
     >-164.55270, 171.40670,  -84.4135,-116.04060,  40.34472, 177.21470,
     >   0.09818,  -0.16707,   0.39853,   1.01174,   0.11321,  -8.09681,
     > -63.45163,  67.35025,  -33.5444, -35.78720,   0.67634,  77.35435,
     >   0.09444,  -0.00883,   0.01631,   0.48641,   0.75042,  -3.50813,
     > -22.50191,  25.16633,  -13.8796,  -3.35048, -18.98215,  41.41481,
     >   0.13703,  -0.13157,   0.08509,   0.59856,   0.33703,  -2.07517,
     > -15.44135,  17.28593,   -8.3733,  -2.69710, -15.26090,  30.91251,
     >   0.16348,  -0.23323,   0.23213,   0.66839,  -0.15593,  -0.12405,
     >  -0.50226,   2.01600,   -0.3333,   3.01560, -11.43827,  11.96062,
     >   0.20392,   0.34990,  -0.29021,  -0.26334,   0.32601,  -1.84819,
     > -27.29761,  29.26534,   -8.3519, -26.31805,  25.31765,  14.88084,
     >   0.13292,   0.82839,  -0.19516,  -0.64962,  -0.08169,  -2.03536,
     > -25.03122,  27.26486,   -9.0402, -17.98038,  14.62220,  17.82652,
     >  -0.03502,   1.53660,   0.30464,  -0.98837,  -0.90028,  -3.04525,
     > -34.26627,  36.25157,  -13.1043, -19.89658,   9.92319,  29.16000,
     >   0.06631,   0.50849,   0.24134,  -0.02506,   0.04681,  -2.02420,
     > -19.86725,  22.22057,   -8.0812,  -8.60552,  -1.14340,  22.96662,
     >   0.19912,  -0.03470,  -0.21733,   0.74794,   1.99866,  12.00579,
     > 133.14500,-131.34500,   50.3953,  78.01322, -41.07031, -98.68988,
     >   0.02943,  -0.00562,   0.37276,   0.67341,   0.63503,   3.14530,
     >  31.26221, -23.10165,   13.0139,  14.89186,   8.88067, -37.30342,
     >   0.09490,  -0.08265,   0.11342,   0.55615,   0.71424,   9.38305,
     > 109.21790,-105.94920,   39.2278,  61.75555, -37.71143, -71.95479,
     >   0.11097,  -0.14123,   0.04190,   0.53337,   0.73467,   9.75060,
     > 116.74240,-114.44280,   40.7202,  64.99192, -45.60560, -69.83845,
     >   0.16487,  -0.36955,   0.09747,   0.77940,   0.53968,  11.46689,
     > 143.54860,-142.87250,   47.9733,  80.91280, -67.31082, -74.43162,
     >   0.16352,  -0.39197,   0.16110,   0.77743,   0.33916,   9.77646,
     > 125.41340,-124.85160,   40.8821,  69.82134, -64.25633, -57.13315,
     >   0.17931,  -0.38454,   0.09285,   0.78593,   0.54824,   8.18135,
     > 108.51540,-108.03990,   34.2808,  60.75234, -60.57848, -43.27182,
     >   0.10761,   0.15969,   0.08635,   0.14387,   0.25802,   0.04132,
     >  -2.28227,   5.23636,    0.2291,  -2.53861,   1.66164,   4.66487,
     >   0.10941,   0.34178,   0.10626,  -0.05603,   0.04493,   1.38484,
     >  13.93085, -10.81636,    5.6676,   2.28570,   5.40626, -11.63717,
     >   0.10054,   0.19825,   0.12858,   0.12295,   0.20559,   2.38548,
     >  27.41983, -24.79956,    9.7290,   8.96407,  -4.61027, -13.88745,
     >   0.21738,   0.36298,  -0.07111,  -0.16769,   0.10431,   1.50257,
     >  14.78478, -11.72642,    6.0471,   0.10630,   9.84034, -14.24114,
     >   0.40820,   0.34029,  -0.42250,  -0.30983,   0.35848,  -0.44837,
     >  -9.19098,  12.62974,   -1.7500,  -8.41921,  15.36829,  -0.14740,
     >   0.27267,  -0.32355,   0.34011,   1.38491,  -0.78603,   1.02601,
     >  13.10174, -11.24457,    4.3095,   6.39974, -12.99586,   5.06634,
     >   0.03148,   0.01778,   0.20309,   0.41731,   0.48027,   2.35043,
     >  31.82812, -20.69792,    9.6382,  14.90834,  -9.76052, -15.29618,
     >   0.07503,  -0.01266,   0.14392,   0.35487,   0.40784,   2.01568,
     >  29.55322, -24.30291,    8.3964,  15.39903, -25.59750,   3.03329,
     >   0.00990,   0.08325,   0.22169,   0.28875,   0.25695,   1.27989,
     >  16.74597, -11.12668,    5.2848,   6.50911,  -7.79131,  -7.02663,
     >   0.13067,   0.17498,   0.06476,   0.04341,   0.13358,  -0.47499,
     >  -9.95857,  13.24265,   -1.8372,  -4.70507,   0.55612,  12.08209,
     >   0.29897,   0.22595,  -0.13675,  -0.11973,   0.16293,  -0.37647,
     > -10.71031,  15.70715,   -1.5260,  -7.93647,  15.27983,   0.36355,
     >   0.22671,  -0.15258,   0.03476,   0.77523,  -0.07452,   0.10783,
     >   1.10054,   0.28489,    0.6076,   2.83722, -17.00431,  19.38120,
     >   0.07382,   0.12048,   0.12807,   0.12460,   0.12146,   0.59225,
     >   8.23836,  -6.02416,    2.5007,   3.22539, -18.04624,  16.85134,
     >   0.07557,   0.11860,   0.12235,   0.11647,   0.11256,   0.72553,
     >  11.03405,  -8.51420,    3.0831,   3.45357, -18.38658,  16.36005,
     >   0.07035,   0.11496,   0.12080,   0.11517,   0.10998,   0.42962,
     >   5.13675,  -1.61125,    1.8356,   0.98780, -15.00416,  17.72561,
     >   0.00174,   0.19943,   0.23342,   0.02655,   0.08788,   0.49033,
     >   6.75723,  -5.64451,    2.1035,   1.36668, -16.76041,  14.27372,
     >  -0.00084,   0.07440,   0.17743,   0.21001,   0.14868,   0.34031,
     >   4.50388,  -7.78262,    1.5018,   1.61800, -25.19937,  13.85968/
      endif

c      IF (WW .GE. 3.9) THEN
c           WW = 3.875
c      ENDIF

       if (ww.lt.1.2) then
        ww1 = 1.175
c       ww1 = 1.183
        tmp = 0
       else if (ww.lt.3.0) then  
        tmp =INT((WW-1.15)/0.05) 
        WW1 = 1.175+tmp*0.05
       else
        tmp = INT((ww-3.0)/0.1)
        ww1 = 3.05+tmp*0.1 
        tmp = tmp+37
       endif
        J = (tmp+1)*6-5
        J1 = (tmp+1)*12-11
        Q4 = QQ*QQ
        Q6 = QQ*QQ*QQ
        Q8 = Q4*Q4

      tmp1 = 12.*(qq/(1.+qq))
      tmp2 = log(qq/.04)

      xx = qq/(qq+ww1-mp2)
      fac = 1+tmp1*(.125**2/(xx**2+.125**2))
      rlog = fac/tmp2

      r1 = rp(j)*rlog
     &+(rp(j+1)/qq+rp(j+2)/(q4+.3**2))
     &*(1.+rp(j+3)*xx+rp(j+4)*(xx**2))
     &*(xx**rp(j+5)) 

      BINDING = 1.
      Q = LOG(QQ)                                                       
      QTH = .2+3.2*XX                                                      
      DQ = Q-QTH
      Y = 1.-XX                                                         
      F2th = F2P(j1)*Y**1+F2P(j1+1)*Y**2+F2P(j1+2)*Y**3+                          
     >       F2P(j1+3)*Y**4+F2P(j1+4)*Y**5                                       
      QUAD = (F2P(j1+5)+F2P(j1+6)*XX+F2P(j1+7)*XX**2)*DQ**2                           
      LIN  = (F2P(j1+8)+F2P(j1+9)*XX+F2P(j1+10)*XX**2
     >+F2P(j1+11)*XX**3)*DQ               
      IF (q.GT.qth) QUAD = 0.                                              
      SCB  = (1.+LIN+QUAD)                                                 
      F21  = F2th*SCB*BINDING  
c      write(*,*) f2th,scb,binding

c      IF (WW.LE.1.2 .OR. WW.GE.3.85
c     >.OR. ABS(WW-WW1).LE.0.001) THEN
      IF (WW.LE.1.2 .OR. ABS(WW-WW1).LE.0.001) THEN
          R = R1
          F2 = F21
      ELSE
          IF (WW.GT.WW1) THEN
             I = J+6
             I1 = J1+12
             IF (WW1 .LT. 1.2) THEN
               WW2 = 1.225
             ELSE IF (WW1 .LT. 2.975) THEN            
               WW2 = WW1+0.05
             ELSE IF (abs(WW1- 2.975) .LT. 0.01) THEN
               WW2 = 3.05
             ELSE IF (abs(WW1-3.85) .LT. 0.01) THEN
               WW2 = 3.75
               I = J - 6
               I1 = J1 - 12
             ELSE 
               WW2 = WW1+0.1
             ENDIF  
          ELSE 
             I = J-6
             I1 = J1-12
             IF (WW1 .LT. 1.25) THEN
               WW2 = 1.175
c               WW2 = 1.183
             ELSE IF (WW1 .LT. 3.05) THEN            
               WW2 = WW1-0.05
             ELSE IF (abs(WW1-3.05) .LT. 0.01) THEN
               WW2 = 2.975
             ELSE 
               WW2 = WW1-0.1
             ENDIF  
          ENDIF    
      xx = qq/(qq+ww2-mp2)
      fac = 1+tmp1*(.125**2/(xx**2+.125**2))
      rlog = fac/tmp2

      r2 = rp(i)*rlog
     &+(rp(i+1)/qq+rp(i+2)/(q4+.3**2))
     &*(1.+rp(i+3)*xx+rp(i+4)*(xx**2))
     &*(xx**rp(i+5))

      Q = LOG(QQ)                                                       
      QTH = .2+3.2*XX                                                      
      DQ = Q-QTH
      Y = 1.-XX                                                         
      F2th = F2P(i1)*Y**1+F2P(i1+1)*Y**2+F2P(i1+2)*Y**3+                          
     >       F2P(i1+3)*Y**4+F2P(i1+4)*Y**5                                       
      QUAD = (F2P(i1+5)+F2P(i1+6)*XX+F2P(i1+7)*XX**2)*DQ**2                           
      LIN  = (F2P(i1+8)+F2P(i1+9)*XX+F2P(i1+10)*XX**2
     >+F2P(i1+11)*XX**3)*DQ               
      IF (q.GT.qth) QUAD = 0.                                              
      SCB  = (1.+LIN+QUAD)                                                 
      F22  = F2th*SCB*BINDING
c      write(*,*) f2th,scb,binding

       R = R1+(WW-WW1)*(R2-R1)/(WW2-WW1)
       F2 = F21+(WW-WW1)*(F22-F21)/(WW2-WW1)
      ENDIF   

        IF (F2.LT.0) THEN
           F2 = 0.001
        ELSEIF (R.LT.0) THEN
           R = 0.001
        ELSE
        ENDIF  
 
        NU = (QQ+WW-MP2)/2/MP
        W2 = F2/NU 
        W1 = W2*(1.0 + NU*NU/QQ)/(1.0 + R)

c        write(*,*) ww,ww1,ww2,r,f2,w1,w2        
c        IF (QQ.GE.4.0) THEN
c           CALL H2MODEL(QQ,WW,W11,W22)
c           frac = (qq - 4.0)/(5.0 - 4.0)
c           w1 = w11*frac + w1*(1.0 - frac)
c           w2 = w22*frac + w2*(1.0 - frac)
c         ENDIF

       ENDIF     

      RETURN
      END                                                               

